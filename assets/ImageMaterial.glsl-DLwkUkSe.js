import{F$ as $,wg as x,G0 as P,G1 as b,G2 as w,G3 as y,G4 as T,G5 as D,G6 as f,G7 as g,G8 as O,G9 as I,Ga as C,Gb as S,Gc as F,_ as j,Gd as M,Ge as z,Gf as A,Gg as q,Gh as B,Gi as E,Gj as W,Gk as k,Gl as L,Gm as V,Gn as H,Go as J,Gp as R,n as l,Gq as c,Gr as v,Gs as d,Gt as K,Gu as N,Gv as Q,Gw as U,Gx as X,ti as Y,Gy as Z,Gz as ee,qJ as te}from"./index-B0e5FEUY.js";import{i as se}from"./TriangleMaterial-DJcelAiS.js";import{f as ie}from"./DefaultLayouts-Xw7RBPls.js";class m extends ${}function _(s){const e=new x,{vertex:t,fragment:i,varyings:u}=e,{output:o,perspectiveInterpolation:n}=s;return P(t,s),e.include(b),e.include(w,s),e.fragment.include(y,s),e.include(T,s),e.include(D,s),e.attributes.add("position","vec3"),e.attributes.add("uv0","vec2"),n&&e.attributes.add("perspectiveDivide","float"),t.main.add(g`
    vpos = position;
    forwardViewPosDepth((view * vec4(vpos, 1.0)).xyz);
    vTexCoord = uv0;
    gl_Position = transformPosition(proj, view, vpos);
    ${f(n,"gl_Position *= perspectiveDivide;")}`),u.add("vpos","vec3",{invariant:!0}),u.add("vTexCoord","vec2"),i.include(O),i.uniforms.add(new I("opacity",r=>r.opacity),new C("tex",r=>r.glTexture)).main.add(g`
    discardBySlice(vpos);
    discardByTerrainDepth();
    ${f(o===10,"fragColor = vec4(0, 0, 0, 1); return;")}
    vec4 finalColor = texture(tex, vTexCoord) * opacity;
    outputColorHighlightOID(finalColor, vpos, finalColor.rgb);`),e}const re=Object.freeze(Object.defineProperty({__proto__:null,ImageMaterialPassParameters:m,build:_},Symbol.toStringTag,{value:"Module"}));let ae=class extends S{constructor(e,t){super(e,t,new F(re,()=>j(()=>Promise.resolve().then(()=>ce),void 0)),G(t).locations)}_getPipelineState(e,t){const{oitPass:i,output:u,hasOccludees:o,cullFace:n}=e;return M({blending:J(u)?H(i,!0):null,culling:V(n),depthTest:{func:L(i)},depthWrite:k(e),drawBuffers:W(i,u),colorWrite:E,stencilWrite:o?B:null,stencilTest:o?t?A:q:null,polygonOffset:z(e)})}initializePipeline(e){return this._occludeePipeline=this._getPipelineState(e,!0),this._getPipelineState(e,!1)}getPipeline(e){return e?this._occludeePipeline:super.getPipeline()}};function G(s){let e=ie;return s.perspectiveInterpolation&&(e=e.clone().f32("perspectiveDivide")),e}class a extends R{constructor(e){super(),this.draped=e,this.cullFace=0,this.enableOffset=!0,this.writeDepth=!0,this.hasOccludees=!1,this.terrainDepthTest=!1,this.cullAboveTerrain=!1,this.perspectiveInterpolation=!0,this.textureCoordinateType=0,this.emissionSource=0,this.discardInvisibleFragments=!0,this.occlusionPass=!1,this.olidColorInstanced=!1,this.snowCover=!1}}l([c({count:3})],a.prototype,"cullFace",void 0),l([c()],a.prototype,"enableOffset",void 0),l([c()],a.prototype,"writeDepth",void 0),l([c()],a.prototype,"hasOccludees",void 0),l([c()],a.prototype,"terrainDepthTest",void 0),l([c()],a.prototype,"cullAboveTerrain",void 0),l([c()],a.prototype,"perspectiveInterpolation",void 0);class fe extends se{constructor(e){super(e,le),this.supportsEdges=!0,this.produces=new Map([[2,t=>v(t)],[4,t=>d(t)&&this.parameters.writeDepth],[8,t=>d(t)&&!this.parameters.writeDepth],[18,t=>d(t)||v(t)]]),this._configuration=new a(e.draped)}dispose(){this.setParameters({texture:void 0})}getConfiguration(e,t){return super.getConfiguration(e,t,this._configuration),this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.hasOccludees=t.hasOccludees,this._configuration.oitPass=t.oitPass,this._configuration.enableOffset=t.camera.relativeElevation<K,this._configuration.terrainDepthTest=t.terrainDepthTest,this._configuration.cullAboveTerrain=t.cullAboveTerrain,this._configuration.perspectiveInterpolation=this.parameters.perspectiveInterpolation,this._configuration}get visible(){return!0}createGLMaterial(e){return new oe(e)}createBufferWriter(){return new ne(G(this.parameters))}}class oe extends Q{constructor(e){super({...e,...e.material.parameters}),this.parameters=e;const t=this._material.parameters.texture;U(t)&&e.textures.updater.add(t)}dispose(){this.parameters.textures.updater.remove(this._material.parameters.texture)}beginSlot(e){return this.getTechnique(ae,e)}}class ne extends X{write(e,t,i,u,o,n){for(const r of this.layout.fields.keys()){const p=i.get(r);if(p)if(r==="perspectiveDivide"){Y(p.size===1);const h=o.getField(r,Z);h&&ee(p,h,n)}else te(r,p,e,t,o,n)}return null}}class le extends N{constructor(e,t){super(),this.texture=e,this.draped=t,this.writeDepth=!0,this.hasSlicePlane=!1,this.cullFace=0,this.opacity=1,this.perspectiveInterpolation=!1}get glTexture(){return this.texture.glTexture}}const ce=Object.freeze(Object.defineProperty({__proto__:null,ImageMaterialPassParameters:m,build:_},Symbol.toStringTag,{value:"Module"}));export{fe as g};
